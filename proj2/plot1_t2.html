<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Zoomable radial chart with color scales</title>
    <link href='http://fonts.googleapis.com/css?family=Varela' rel='stylesheet'
          type='text/css'>
    <style>
        body { font-family: Varela,sans-serif; }
    </style>
</head>
<body>
    <script src='http://d3js.org/d3.v3.min.js'></script>

    <!--
        Because of cross-origin restrictions, we have to use
        a hack to load our map data and tornado dataset.
    -->
    <script src='http://jsDataV.is/data/tornadoes.js'></script>

    <script>

        // Define the dimensions of the visualization.
        var margin = {top: 30, right: 10, bottom: 20, left: 10},
            width = 636 - margin.left - margin.right,
            height = 476 - margin.top - margin.bottom,
            radius = Math.min(width, height) / 2;

        // Create the SVG container for the visualization and
        // define its dimensions. Within that container, add a
        // group element (`<g>`) that can be transformed via
        // a translation to account for the margins and to
        // center the visualization in the container.
        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("g")
            .attr("transform", "translate(" +
                    (margin.left + width  / 2) + "," +
                    (margin.top  + height / 2) + ")");

        // Define the scales that will translate data values
        // into visualization properties. The "x" scale
        // will represent angular position within the
        // visualization, so it ranges lnearly from 0 to
        // 2Ï€. The "y" scale will reprent area, so it
        // ranges from 0 to the full radius of the
        // visualization. Since area varies as the square
        // of the radius, this scale takes the square
        // root of the input domain before mapping to
        // the output range.
        var x = d3.scale.linear()
            .range([0, 2 * Math.PI]);
        var y = d3.scale.sqrt()
            .range([0, radius]);

        // Define the function that creates a partition
        // layout from the dataset. Because we're using
        // `d3.nest` to construct the input dataset, the
        // children array will be stored in the `values`
        // property unless the node is a leaf node. In
        // that case the `values` property will hold
        // the data value itself.
        var partition = d3.layout.partition()
            .children(function(d) {
                return Array.isArray(d.values) ?
                    d.values : null;
            })
            .value(function(d) {
                return d.values;
            });

        // Define a function that returns the color
        // for a data point. The input parameter
        // should be a data point as defined/created
        // by the partition layout.

      var color = d3.scale.linear().domain([1,8])
      .interpolate(d3.interpolateHcl)
      .range(["#E1C680", "#708C02"]);

        // Define the function that constructs the
        // path for an arc corresponding to a data
        // value.
        var arc = d3.svg.arc()
            .startAngle(function(d) {
                return Math.max(0,
                    Math.min(2 * Math.PI, x(d.x)));
            })
            .endAngle(function(d) {
                return Math.max(0,
                    Math.min(2 * Math.PI, x(d.x + d.dx)));
            })
            .innerRadius(function(d) {
                return Math.max(0, y(d.y));
            })
            .outerRadius(function(d) {
                return Math.max(0, y(d.y + d.dy));
            });

        // Extract the hierachy from the raw data
        // Using `d3.nest` operations. The data's
        // hierarchy is region -> state -> county.
        // At the county level, we're only interested
        // in a count of the data points.
        var hierarchy = {
            key: "United States",
            values: d3.nest()
                .key(function(d) { return d.region; })
                .key(function(d) { return d.state; })
                .key(function(d) { return d.county; })
                .rollup(function(leaves) {
                    return leaves.length;
                })
                .entries(dataset)
        };


        var hierarchy = {
            key: "United States",
            values: d3.nest()
                .key(function(d) { return d.region; })
                .key(function(d) { return d.state; })
                .key(function(d) { return d.county; })
                .rollup(function(leaves) {
                    return leaves.length;
                })
                .entries(dataset)
        };

        // Construct the visualization.
        var path = svg.selectAll("path")
            .data(partition.nodes(hierarchy))
          .enter().append("path")
            .attr("d", arc)
            .attr("stroke", "#fff")
            // .attr("fill-rule", "evenodd")
            .attr("fill", color(2));







</script>
